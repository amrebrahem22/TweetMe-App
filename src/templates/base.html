{% load static %}
<!DOCTYPE html>
<html>
<head>
	<title>{% block title %}Home{% endblock %}</title>
	<link rel="stylesheet" type="text/css" href="{% static 'static/css/bootstrap.min.css' %}">
	<link rel="stylesheet" type="text/css" href="{% static 'static/css/style.css' %}">
    <style type="text/css">
        .tweet a {color: #4fc4f6;}
    </style>
</head>
<body>
<div class="main-container">

            {% include 'navbar.html' %}

            <!-- LEFT-CONTAINER -->
            <div class="left-container container">
            	<div class="profile block"> <!-- PROFILE (MIDDLE-CONTAINER) -->
                    <a class="add-button" href="#28"><span class="icon entypo-plus scnd-font-color"></span></a>
                    <div class="profile-picture big-profile-picture clear">
                        <img width="150px" alt="Anne Hathaway picture" src="http://upload.wikimedia.org/wikipedia/commons/e/e1/Anne_Hathaway_Face.jpg" >
                    </div>
                    <h1 class="user-name">Anne Hathaway</h1>
                    <div class="profile-description">
                        <p class="scnd-font-color">Lorem ipsum dolor sit amet consectetuer adipiscing</p>
                    </div>
                    <ul class="profile-options horizontal-list">
                        <li><a class="comments" href="#40"><p><span class="icon fontawesome-comment-alt scnd-font-color"></span>23</li></p></a>
                        <li><a class="views" href="#41"><p><span class="icon fontawesome-eye-open scnd-font-color"></span>841</li></p></a>
                        <li><a class="likes" href="#42"><p><span class="icon fontawesome-heart-empty scnd-font-color"></span>49</li></p></a>
                    </ul>
                </div>
                <div class="menu-box block"> <!-- MENU BOX (LEFT-CONTAINER) -->
                    <h2 class="titular">MENU BOX</h2>
                    <ul class="menu-box-menu">
                        <li>
                            <a class="menu-box-tab" href="#6"><span class="icon fontawesome-envelope scnd-font-color"></span>Messages<div class="menu-box-number">24</div></a>                            
                        </li>
                        <li>
                            <a class="menu-box-tab" href="#8"><span class="icon entypo-paper-plane scnd-font-color"></span>Invites<div class="menu-box-number">3</div></a>                            
                        </li>
                        <li>
                            <a class="menu-box-tab" href="#10"><span class="icon entypo-calendar scnd-font-color"></span>Events<div class="menu-box-number">5</div></a>                            
                        </li>
                        <li>
                            <a class="menu-box-tab" href="#12"><span class="icon entypo-cog scnd-font-color"></span>Account Settings</a>
                        </li>
                        <li>
                            <a class="menu-box-tab" href="#13"><sapn class="icon entypo-chart-line scnd-font-color"></sapn>Statistics</a>
                        </li>                        
                    </ul>
                </div>
                <div class="donut-chart-block block"> <!-- DONUT CHART BLOCK (LEFT-CONTAINER) -->
                    <h2 class="titular">OS AUDIENCE STATS</h2>
                    <div class="donut-chart">
                        <!-- DONUT-CHART by @kseso https://codepen.io/Kseso/pen/phiyL -->
                        <div id="porcion1" class="recorte"><div class="quesito ios" data-rel="21"></div></div>
                        <div id="porcion2" class="recorte"><div class="quesito mac" data-rel="39"></div></div>
                        <div id="porcion3" class="recorte"><div class="quesito win" data-rel="31"></div></div>
                        <div id="porcionFin" class="recorte"><div class="quesito linux" data-rel="9"></div></div>
                        <!-- END DONUT-CHART by @kseso https://codepen.io/Kseso/pen/phiyL -->    
                        <p class="center-date">JUNE<br><span class="scnd-font-color">2013</span></p> 
                    </div>
                    <ul class="os-percentages horizontal-list">
                        <li>
                            <p class="ios os scnd-font-color">iOS</p>
                            <p class="os-percentage">21<sup>%</sup></p>
                        </li>
                        <li>
                            <p class="mac os scnd-font-color">Mac</p>
                            <p class="os-percentage">48<sup>%</sup></p>
                        </li>
                        <li>
                            <p class="linux os scnd-font-color">Linux</p>
                            <p class="os-percentage">9<sup>%</sup></p>
                        </li>
                        <li>
                            <p class="win os scnd-font-color">Win</p>
                            <p class="os-percentage">32<sup>%</sup></p>
                        </li>
                    </ul>
                </div>
                <div class="line-chart-block block clear"> <!-- LINE CHART BLOCK (LEFT-CONTAINER) -->
                    <div class="line-chart">
                      <!-- LINE-CHART by @kseso https://codepen.io/Kseso/pen/phiyL -->
                        <div class='grafico'>
                           <ul class='eje-y'>
                             <li data-ejeY='30'></li>
                             <li data-ejeY='20'></li>
                             <li data-ejeY='10'></li>
                             <li data-ejeY='0'></li>
                           </ul>
                           <ul class='eje-x'>
                             <li>Apr</li>
                             <li>May</li>
                             <li>Jun</li>
                           </ul>
                             <span data-valor='25'>
                               <span data-valor='8'>
                                 <span data-valor='13'>
                                   <span data-valor='5'>   
                                     <span data-valor='23'>   
                                     <span data-valor='12'>
                                         <span data-valor='15'>
                                         </span></span></span></span></span></span></span>
                        </div>
                        <!-- END LINE-CHART by @kseso https://codepen.io/Kseso/pen/phiyL -->
                    </div>
                    <ul class="time-lenght horizontal-list">
                        <li><a class="time-lenght-btn" href="#14">Week</a></li>
                        <li><a class="time-lenght-btn" href="#15">Month</a></li>
                        <li><a class="time-lenght-btn" href="#16">Year</a></li>
                    </ul>
                    <ul class="month-data clear">
                        <li>
                            <p>APR<span class="scnd-font-color"> 2013</span></p>
                            <p><span class="entypo-plus increment"> </span>21<sup>%</sup></p>
                        </li>
                        <li>
                            <p>MAY<span class="scnd-font-color"> 2013</span></p>
                            <p><span class="entypo-plus increment"> </span>48<sup>%</sup></p>
                        </li>
                        <li>
                            <p>JUN<span class="scnd-font-color"> 2013</span></p>
                            <p><span class="entypo-plus increment"> </span>35<sup>%</sup></p>
                        </li>
                    </ul>
                </div>
                
                <ul class="social horizontal-list block"> <!-- SOCIAL (LEFT-CONTAINER) -->
                    <li class="facebook"><p class="icon"><span class="zocial-facebook"></span></p><p class="number">248k</p></li>
                    <li class="twitter"><p class="icon"><span class="zocial-twitter"></span></p><p class="number">30k</p></li>
                    <li class="googleplus"><p class="icon"><span class="zocial-googleplus"></span></p><p class="number">124k</p></li>
                    <li class="mailbox"><p class="icon"><span class="fontawesome-envelope"></span></p><p class="number">89k</p></li>
                </ul>
            </div>











            <!-- MIDDLE-CONTAINER -->
            <div class="middle-container container tweets-container">
            	{% block main %}
            	<form class="create-tweet" action="{% url 'tweet:create' %}" method="POST">
            		{% csrf_token %}
            		{{form.content}}
            		<p>Maximum length 140 character.</p>
            		<input type="submit" class="tweet-btn" value="Tweet">
            	</form>
            	
                <div class="tweets block" style="margin-bottom: 0;"> <!-- TWEETS (MIDDLE-CONTAINER) -->
				    <h2 class="titular"><span class="icon zocial-twitter"></span>LATEST TWEETS</h2>
				</div> 
				<div class="tweets block tweet-container"></div>
				<div><a href="" id="loadMore">Load more</a></div>
            	{% endblock main %}
            </div>








            

            <!-- RIGHT-CONTAINER -->
            <div class="right-container container">
                <div class="join-newsletter block"> <!-- JOIN NEWSLETTER (RIGHT-CONTAINER) -->
                    <h2 class="titular">JOIN THE NEWSLETTER</h2>
                    <div class="input-container">
                        <input type="text" placeholder="yourname@gmail.com" class="email text-input">
                        <div class="input-icon envelope-icon-newsletter"><span class="fontawesome-envelope scnd-font-color"></span></div>
                    </div>
                    <a class="subscribe button" href="#21">SUBSCRIBE</a>
                </div>
                <div class="account block"> <!-- ACCOUNT (RIGHT-CONTAINER) -->
                    <h2 class="titular">SIGN IN TO YOUR ACCOUNT</h2>
                    <div class="input-container">
                        <input type="text" placeholder="yourname@gmail.com" class="email text-input">
                        <div class="input-icon envelope-icon-acount"><span class="fontawesome-envelope scnd-font-color"></span></div>
                    </div>
                    <div class="input-container">
                        <input type="text" placeholder="Password" class="password text-input">
                        <div class="input-icon password-icon"><span class="fontawesome-lock scnd-font-color"></span></div>
                    </div>
                    <a class="sign-in button" href="#22">SIGN IN</a>
                    <p class="scnd-font-color">Forgot Password?</p>
                    <a class="fb-sign-in" href="58">
                        <p><span class="fb-border"><span class="icon zocial-facebook"></span></span>Sign in with Facebook</p>
                    </a>
                </div>
                <div class="loading block"> <!-- LOADING (RIGHT-CONTAINER) -->
                    <div class="progress-bar downloading"></div>
                    <p><span class="icon fontawesome-cloud-download scnd-font-color"></span>Downloading...</p>
                    <p class="percentage">81<sup>%</sup></p>
                    <div class="progress-bar uploading"></div>
                    <p><span class="icon fontawesome-cloud-upload scnd-font-color"></span>Uploading...</p>
                    <p class="percentage">43<sup>%</sup></p>
                </div>
                <div class="calendar-day block"> <!-- CALENDAR DAY (RIGHT-CONTAINER) -->
                    <div class="arrow-btn-container">
                        <a class="arrow-btn left" href="#200"><span class="icon fontawesome-angle-left"></span></a>
                        <h2 class="titular">WEDNESDAY</h2>
                        <a class="arrow-btn right" href="#201"><span class="icon fontawesome-angle-right"></span></a>
                    </div>
                        <p class="the-day">26</p>
                        <a class="add-event button" href="#27">ADD EVENT</a>
                </div>
                <div class="calendar-month block"> <!-- CALENDAR MONTH (RIGHT-CONTAINER) -->
                    <div class="arrow-btn-container">
                        <a class="arrow-btn left" href="#202"><span class="icon fontawesome-angle-left"></span></a>
                        <h2 class="titular">APRIL 2013</h2>
                        <a class="arrow-btn right" href="#203"><span class="icon fontawesome-angle-right"></span></a>
                    </div>
                    <table class="calendar">
                        <thead class="days-week">
                            <tr>
                                <th>S</th>
                                <th>M</th>
                                <th>T</th>
                                <th>W</th>
                                <th>R</th>
                                <th>F</th>
                                <th>S</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td><a class="scnd-font-color" href="#100">1</a></td>
                            </tr>
                            <tr>
                                <td><a class="scnd-font-color" href="#101">2</a></td>
                                <td><a class="scnd-font-color" href="#102">3</a></td>
                                <td><a class="scnd-font-color" href="#103">4</a></td>
                                <td><a class="scnd-font-color" href="#104">5</a></td>
                                <td><a class="scnd-font-color" href="#105">6</a></td>
                                <td><a class="scnd-font-color" href="#106">7</a></td>
                                <td><a class="scnd-font-color" href="#107">8</a></td>
                            </tr>
                            <tr>
                                <td><a class="scnd-font-color" href="#108">9</a></td>
                                <td><a class="scnd-font-color" href="#109">10</a></td>
                                <td><a class="scnd-font-color" href="#110">11</a></td>
                                <td><a class="scnd-font-color" href="#111">12</a></td>
                                <td><a class="scnd-font-color" href="#112">13</a></td>
                                <td><a class="scnd-font-color" href="#113">14</a></td>
                                <td><a class="scnd-font-color" href="#114">15</a></td>
                            </tr>
                            <tr>
                                <td><a class="scnd-font-color" href="#115">16</a></td>
                                <td><a class="scnd-font-color" href="#116">17</a></td>
                                <td><a class="scnd-font-color" href="#117">18</a></td>
                                <td><a class="scnd-font-color" href="#118">19</a></td>
                                <td><a class="scnd-font-color" href="#119">20</a></td>
                                <td><a class="scnd-font-color" href="#120">21</a></td>
                                <td><a class="scnd-font-color" href="#121">22</a></td>
                            </tr>
                            <tr>
                                <td><a class="scnd-font-color" href="#122">23</a></td>
                                <td><a class="scnd-font-color" href="#123">24</a></td>
                                <td><a class="scnd-font-color" href="#124">25</a></td>
                                <td><a class="today" href="#125">26</a></td>
                                <td><a href="#126">27</a></td>
                                <td><a href="#127">28</a></td>
                                <td><a href="#128">29</a></td>
                            </tr>
                            <tr>
                                <td><a href="#129">30</a></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div> <!-- end calendar-month block --> 
            </div> <!-- end right-container -->
        </div> <!-- end main-container -->

	{% block body %}

	{% endblock body %}

	<script type="text/javascript" src="{% static "static/js/jquery.min.js" %}"></script>
	{% block scripts %}
		<script> 

			$(document).ready(function() {

				var query = getParameterByName('q');
				var tweetsList = [];
				var nextUrlPage;

                function updateHashLinks(){
                    $(".tweet").each(function(data){
                        var hashtagRegex = /(^|\s)#([\w\d-]+)/g
                        var newText = $(this).html().replace(hashtagRegex, "$1<a href='/tags/$2/'>#$2</a>")
                        $(this).html(newText)
                    
                })
              }

				function getParameterByName( name ){
					var regexS = "[\\?&]"+name+"=([^&#]*)", 
					regex = new RegExp( regexS ),
					results = regex.exec( window.location.search );
					if( results == null ){
					return "";
					} else{
					return decodeURIComponent(results[1].replace(/\+/g, " "));
					}
				}

				function displayTweets(tweetVal, prepend, retweet) {

                    if (retweet && tweetVal.parent) {
                        var mainTweet = tweetVal.parent;
                        console.log(mainTweet)
                        var tweet = "<div class='tweet first'>" + "<p>" + mainTweet.content + " | <span>Retweet Via</span> <a href='" + mainTweet.user.url + "' class='tweet-link'>@" + mainTweet.user.username + "</a>" + "</p>" + "<p> <span>on</span> <a class='time-ago scnd-font-color' href='#18'>"+ mainTweet.date_display +"</a></p>" + " <span>from</span> <a href='/tweet/" + mainTweet.id + "'>view</a> | <a class='time-ago scnd-font-color' href='/tweet/"+ tweetVal.id +"/retweet/'>Retweet</a>" + "</div>";
                    } else {
                        var tweet = "<div class='tweet first'>" + "<p>" + tweetVal.content + " <a href='" + tweetVal.user.url + "' class='tweet-link'>@" + tweetVal.user.username + "</a>" + "</p>" + "<p><a class='time-ago scnd-font-color' href='#18'>"+ tweetVal.date_display +"</a> | <a class='time-ago scnd-font-color' href='/tweet/"+ tweetVal.id +"/retweet/'>Retweet</a></p>" + "</div>";    
                    }
					
					if (prepend == true) {
						$('.tweet-container').prepend(tweet)
					} else {
						$('.tweet-container').append(tweet)
					}
				}

				function tweets() {

					if (tweetsList == 0) {
						var tweet = "<div class='tweet first'>" + "<p>No Tweets Yet.</p></div>";
						$('.tweet-container').append(tweet)

					} else {
						$.each(tweetsList, function(key, value) {
                            if (value.parent) {
                                displayTweets(value, false, true)    
                            }
							displayTweets(value)
                            updateHashLinks()
						});
					}
				}

				function fetchTweets(url) {
					var urlPath;

					if (!url) {
						urlPath = '/api/tweets/';
					} else {
						urlPath = url
					}
					$.ajax({
						url: urlPath,
						method: 'GET',
						data: { 'q': query},
						success: function(data) {
							tweetsList = data.results
							if (data.next) {
								nextUrlPage = data.next
							} else {
								$('#loadMore').css('display', 'none')
							}
							tweets()
                            updateHashLinks()
						},
						error: function(error) {
							console.log(error)
						}
					});
				}
				fetchTweets()

				var startLength = 140;
				var currLength = 0;
				var CounterP = $('.create-tweet p');

				$('.create-tweet textarea').keyup(function (e) {
					var textVal = $(this).val();
					
					currLength = startLength - textVal.length;
					CounterP.text(currLength);

					if (currLength >= 0) {
						CounterP.css({'color': '#556292'});
					} else {
						CounterP.css({'color': '#dc3545'});
					}
				});

				$('.create-tweet').submit(function (e) {
					e.preventDefault();
					var this_ = $(this).serialize();
					if (currLength >= 0) {
						$.ajax({
							url: '/api/tweets/create/',
							method: 'Post',
							data: this_,
							success: function(data) {
								displayTweets(data, true)
								$('.create-tweet').find('textarea').val('')
								CounterP.text("Maximum length 140 character");
							},
							error: function(error) {
								console.log(error)
							}
						});
					} else {
						CounterP.text("Tweet Can't be more than 140 Character.");
					}
					
				});


				// Auto Search
				var searchField = $('.search-form input[type=text]');
				var inputVal;
				var searchTimeOut;

				searchField.keyup(function (e) {
					inputVal = $(this).val();
					clearInterval(searchTimeOut)
					searchTimeOut = setTimeout(done_search, 500)
				})

				$('.search-form').keydown(function (e) {
					clearInterval(searchTimeOut)
				})

				function done_search() {
					if (inputVal) {
						document.location.href='/?q='+inputVal
					}
				}

				$('#loadMore').click(function(e) {
					e.preventDefault();
					if (nextUrlPage) {
						fetchTweets(nextUrlPage);
					}
				});

				
			});	
		</script>
	{% endblock %}
	<script type="text/javascript" src="{% static "static/js/popper.min.js" %}"></script>
	<script type="text/javascript" src="{% static "static/js/bootstrap.min.js" %}"></script>

</body>
</html>